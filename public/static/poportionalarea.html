<html>
   <head>
      <script type = "text/javascript" src = "https://d3js.org/d3.v4.min.js"></script>
      <style>
          #tooltip {
              background-color: white;
              border: 1px solid black;
              padding: 5px;
          }
      </style>
    </head>
  <body>
    <div>
        <svg id="parea" width=500 height=500>
        </svg>
    </div>
    <script type="text/javascript">
        const svg = d3.select('svg')

        const parea_data = [
            {name: "Fonds privés", value: 60},
            {name: "Fonds propres", value: 80},
            {name: "Fonds publics", value: 72}
        ]

        const width = svg.node().getBoundingClientRect().width;
        const height = svg.node().getBoundingClientRect().height;
        const total = parea_data.reduce((accum, item) => accum + item.value, 0);

        const color = d3.scaleOrdinal()
            .domain(parea_data.map(d => d.name))
            .range(["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"])

        parea_data.forEach(function (element, index) {
            element['pc'] = element.value / total
            element['id'] = index
            element['width'] = height * element['pc'];
            element['height'] = height * element['pc'];
            element['fill'] = color(index)
        })

        parea_data[0]['x'] =  10;
        parea_data[0]['y'] =  height - height * parea_data[0]['pc'];
        parea_data[1]['x'] = 20 + height * parea_data[0]['pc'];
        parea_data[1]['y'] = height - height * parea_data[1]['pc'];
        parea_data[2]['x'] = parea_data[1]['x'];
        parea_data[2]['y'] = - 10 + parea_data[1]['y'] - height * parea_data[2]['pc'] ;

        svg.selectAll('rect')
            .data(parea_data)
            .enter()
            .append('rect')
                .attr('x', function(d) { return d.x})
                .attr('y', function(d) { return d.y})
                .attr('width', function(d) { return d.width})
                .attr('height', function(d) { return d.height})
                .attr('fill', function(d) { return d.fill})

        let texts = d3.select('svg')
            .selectAll('text')
            .data(parea_data)
            .enter()
            .append('text');

        texts.append('tspan')
            .attr('x', function(d) { return d.x + 10 })
            .attr('y', function(d) { return d.y + 20 })
            .attr('fill', 'white')
            .text(function(d) { return d.value + ' €'})
        texts.append('tspan')
            .attr('x', function(d) { return d.x + 10 })
            .attr('y', function(d) { return d.y + 40 })
            .attr('fill', 'white')
            .text(function(d) { return d.name })



    </script>
  </body>
</html>
